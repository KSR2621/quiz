<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Java Quiz App</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f4f7f9;
            color: #333;
            line-height: 1.6;
            margin: 0;
            padding: 0;
        }
        nav {
            background-color: #2c3e50;
            padding: 10px 40px;
            display: flex;
            justify-content: center;
            gap: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        nav button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s;
        }
        nav button:hover {
            background-color: #2980b9;
        }
        .main-content {
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }
        .container {
            max-width: 800px;
            width: 100%;
            margin: 20px auto;
            background-color: #fff;
            padding: 20px 40px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        h1, h2, h3 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; text-align: center; }
        .question-block { margin-bottom: 35px; }
        .question-block h4 { font-size: 1.1em; margin-bottom: 15px; }
        pre { background-color: #2d2d2d; color: #f8f8f2; padding: 15px; border-radius: 5px; overflow-x: auto; font-family: 'Courier New', Courier, monospace; }
        .options { list-style-type: none; padding-left: 0; }
        .options li { margin: 10px 0; }
        .options label { display: block; padding: 10px; background-color: #ecf0f1; border-radius: 5px; cursor: pointer; transition: background-color 0.3s; }
        .options label:hover { background-color: #d6eaf8; }
        .options input[type="radio"] { margin-right: 10px; }
        code { font-family: 'Courier New', Courier, monospace; background-color: #e0e0e0; padding: 2px 4px; border-radius: 3px; }
        #submit-btn, #start-quiz-btn { display: block; width: 100%; padding: 15px; font-size: 1.2em; font-weight: bold; color: #fff; background-color: #3498db; border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.3s; }
        #submit-btn:hover, #start-quiz-btn:hover { background-color: #2980b9; }
        #name-input { width: calc(100% - 24px); padding: 12px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 5px; font-size: 1.1em; }
        #results-list { list-style-type: none; padding: 0; }
        #results-list li { padding: 15px; border-radius: 5px; margin-bottom: 15px; border-left: 5px solid #ccc; }
        .correct { border-left-color: #28a745; background-color: #d4edda; }
        .incorrect { border-left-color: #dc3545; background-color: #f8d7da; }
        .explanation { margin-top: 15px; padding-top: 10px; border-top: 1px solid #bdc3c7; font-size: 0.95em; }
        .explanation strong { color: #2c3e50; }
        /* Admin Page Styles */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px 15px; border: 1px solid #ddd; text-align: left; }
        th { background-color: #2c3e50; color: #fff; }
        tbody tr:nth-child(even) { background-color: #f2f2f2; }
        #admin-status { text-align: center; font-style: italic; color: #7f8c8d; }
        .delete-btn {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .delete-btn:hover { background-color: #c0392b; }
    </style>
</head>
<body>
    <nav>
        <button id="nav-quiz">Take Quiz</button>
        <button id="nav-admin">View Admin Panel</button>
    </nav>
    <div class="main-content">
        <!-- Name Container -->
        <div class="container view" id="name-container">
            <h1>Welcome to the Java Quiz</h1>
            <p>Please enter your name to begin.</p>
            <input type="text" id="name-input" placeholder="Your Name" required>
            <button id="start-quiz-btn">Start Quiz</button>
        </div>

        <!-- Quiz Container -->
        <div class="container view" id="quiz-container" style="display: none;">
            <h1>Java Fundamentals Quiz</h1>
            <form id="quiz-form">
                <!-- Topic 1 -->
                <h2>Topic 1: Input, Output, Variables, & Data Types</h2>
                <div class="question-block" data-question-id="q1"><h4>Question 1: What will be the output of the following Java code snippet?</h4><pre><code>System.out.println(10 + 5 + " is the result, not " + 10 + 5);</code></pre><ul class="options"><li><label><input type="radio" name="q1" value="a"> a) 15 is the result, not 15</label></li><li><label><input type="radio" name="q1" value="b"> b) 15 is the result, not 105</label></li><li><label><input type="radio" name="q1" value="c"> c) 105 is the result, not 105</label></li><li><label><input type="radio" name="q1" value="d"> d) A compilation error.</label></li></ul></div>
                <div class="question-block" data-question-id="q2"><h4>Question 2: What is the final value of <code>myInt</code>?</h4><pre><code>double myDouble = 9.99d; int myInt = (int) myDouble;</code></pre><ul class="options"><li><label><input type="radio" name="q2" value="a"> a) 9</label></li><li><label><input type="radio" name="q2" value="b"> b) 10</label></li><li><label><input type="radio" name="q2" value="c"> c) 9.99</label></li><li><label><input type="radio" name="q2" value="d"> d) A RuntimeException.</label></li></ul></div>
                <div class="question-block" data-question-id="q3"><h4>Question 3: If a user inputs 25 then "John Doe", what is stored in <code>name</code>?</h4><pre><code>int age = scanner.nextInt(); String name = scanner.nextLine();</code></pre><ul class="options"><li><label><input type="radio" name="q3" value="a"> a) "John Doe"</label></li><li><label><input type="radio" name="q3" value="b"> b) " John Doe"</label></li><li><label><input type="radio" name="q3" value="c"> c) "" (an empty string)</label></li><li><label><input type="radio" name="q3" value="d"> d) The program will wait.</label></li></ul></div>
                <div class="question-block" data-question-id="q4"><h4>Question 4: Which variable declarations cause a compilation error?</h4><pre><code>1: int _a; 2: int $my; 3: int 1st; 4: int final;</code></pre><ul class="options"><li><label><input type="radio" name="q4" value="a"> a) Only 3</label></li><li><label><input type="radio" name="q4" value="b"> b) Only 4</label></li><li><label><input type="radio" name="q4" value="c"> c) Both 3 and 4</label></li><li><label><input type="radio" name="q4" value="d"> d) Both 1 and 2</label></li></ul></div>
                <div class="question-block" data-question-id="q5"><h4>Question 5: What is the output?</h4><pre><code>int x = Integer.MAX_VALUE; x = x + 1; System.out.println(x);</code></pre><ul class="options"><li><label><input type="radio" name="q5" value="a"> a) 2147483648</label></li><li><label><input type="radio" name="q5" value="b"> b) Throws an ArithmeticException.</label></li><li><label><input type="radio" name="q5" value="c"> c) -2147483648</label></li><li><label><input type="radio" name="q5" value="d"> d) 0</label></li></ul></div>
                <!-- Topic 2 -->
                <h2>Topic 2: Conditional Statements and switch-break</h2>
                <div class="question-block" data-question-id="q6"><h4>Question 6: What is the output?</h4><pre><code>int code = 2; String r = ""; switch (code) { case 1: r+="A"; case 2: r+="B"; case 3: r+="C"; break; }</code></pre><ul class="options"><li><label><input type="radio" name="q6" value="a"> a) B</label></li><li><label><input type="radio" name="q6" value="b"> b) BC</label></li><li><label><input type="radio" name="q6" value="c"> c) BCD</label></li><li><label><input type="radio" name="q6" value="d"> d) B D</label></li></ul></div>
                <div class="question-block" data-question-id="q7"><h4>Question 7: Given <code>x=10, y=5, z=12</code>, which is true?</h4><ul class="options"><li><label><input type="radio" name="q7" value="a"> a) <code>if (x > y && z < y)</code></label></li><li><label><input type="radio" name="q7" value="b"> b) <code>if (x < y || z < x)</code></label></li><li><label><input type="radio" name="q7" value="c"> c) <code>if (x > z || (y == 5 && x < z))</code></label></li><li><label><input type="radio" name="q7" value="d"> d) <code>if (x == z && y != z)</code></label></li></ul></div>
                <div class="question-block" data-question-id="q8"><h4>Question 8: What is the output for <code>score = 85</code>?</h4><pre><code>if (score >= 60) { System.out.print("Pass. "); if (score >= 80) { System.out.print("Grade: B"); } }</code></pre><ul class="options"><li><label><input type="radio" name="q8" value="a"> a) Pass. Grade: B</label></li><li><label><input type="radio" name="q8" value="b"> b) Pass.</label></li><li><label><input type="radio" name="q8" value="c"> c) Pass. Grade: A</label></li><li><label><input type="radio" name="q8" value="d"> d) Grade: B</label></li></ul></div>
                <div class="question-block" data-question-id="q9"><h4>Question 9: What is the value of <code>category</code>?</h4><pre><code>int temp = 25; String cat = temp > 30 ? "Hot" : temp < 15 ? "Cold" : "Moderate";</code></pre><ul class="options"><li><label><input type="radio" name="q9" value="a"> a) "Hot"</label></li><li><label><input type="radio" name="q9" value="b"> b) "Cold"</label></li><li><label><input type="radio" name="q9" value="c"> c) "Moderate"</label></li><li><label><input type="radio" name="q9" value="d"> d) Won't compile.</label></li></ul></div>
                <div class="question-block" data-question-id="q10"><h4>Question 10: What is the output?</h4><pre><code>String day = "Holiday"; switch (day) { case "Work": ...; case "Weekend": ...; }</code></pre><ul class="options"><li><label><input type="radio" name="q10" value="a"> a) Work day</label></li><li><label><input type="radio" name="q10" value="b"> b) Weekend</label></li><li><label><input type="radio" name="q10" value="c"> c) No output.</label></li><li><label><input type="radio" name="q10" value="d"> d) A compilation error.</label></li></ul></div>
                <button type="submit" id="submit-btn">Submit Quiz</button>
            </form>
        </div>

        <!-- Results Container -->
        <div class="container view" id="results-container" style="display: none;">
            <h2 id="result-header"></h2>
            <p id="score-text" style="text-align: center; font-size: 1.2em;"></p>
            <p id="firebase-status" style="text-align: center; font-style: italic;"></p>
            <h3>Answer Key & Explanations</h3>
            <ul id="results-list"></ul>
        </div>

        <!-- Admin Container -->
        <div class="container view" id="admin-container" style="display: none;">
            <h1>Quiz Admin Results</h1>
            <p id="admin-status">Loading results from Firebase...</p>
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Score</th>
                        <th>Date & Time</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="admin-results-body">
                    <!-- Data will be inserted here -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
      import { getDatabase, ref, push, set, onValue, remove } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";
      
      const firebaseConfig = {
        apiKey: "AIzaSyDYGPni4PdzWOMTg1-zL7klmmMPgrZNn2I",
        authDomain: "to-do-list-84cee.firebaseapp.com",
        databaseURL: "https://to-do-list-84cee-default-rtdb.firebaseio.com",
        projectId: "to-do-list-84cee",
        storageBucket: "to-do-list-84cee.firebasestorage.app",
        messagingSenderId: "623916391670",
        appId: "1:623916391670:web:af46cbb278d2fac6f060d7"
      };

      const app = initializeApp(firebaseConfig);
      const database = getDatabase(app);

      // --- DOM Elements & Global State ---
      const allViews = document.querySelectorAll('.view');
      const nameInput = document.getElementById('name-input');
      const quizForm = document.getElementById('quiz-form');
      let userName = '';
      
      // --- Answer Key & Explanations ---
      const answerKey = {
        q1: { answer: 'b', explanation: 'Java evaluates expressions left to right. `10 + 5` is integer addition (15). Then, `15 + " is..."` starts string concatenation. Every subsequent `+` also concatenates, making the end result `...not 105`.' },
        q2: { answer: 'a', explanation: 'Casting a `double` to an `int` truncates (cuts off) the decimal part, it does not round. So, 9.99 becomes 9.' },
        q3: { answer: 'c', explanation: '`scanner.nextInt()` reads the integer but leaves the newline character (\\n) in the buffer. The next `scanner.nextLine()` reads this leftover newline, returning an empty string.' },
        q4: { answer: 'c', explanation: 'Variable names cannot start with a number (`1stPlace`) and cannot be a reserved keyword (`final`).' },
        q5: { answer: 'c', explanation: 'Adding 1 to `Integer.MAX_VALUE` causes an integer overflow, which "wraps around" to `Integer.MIN_VALUE` (-2147483648).' },
        q6: { answer: 'b', explanation: 'The switch starts at `case 2` and "falls through" to `case 3` because `case 2` has no `break` statement. The `break` in `case 3` stops it.' },
        q7: { answer: 'c', explanation: 'Evaluation: `(10 > 12 || (5 == 5 && 10 < 12))` -> `(false || (true && true))` -> `(false || true)` -> `true`.' },
        q8: { answer: 'a', explanation: '`score >= 60` is true, so "Pass. " is printed. Then, `score >= 80` is also true, so "Grade: B" is printed.' },
        q9: { answer: 'c', explanation: 'The first ternary `temp > 30` is false, so the second part is evaluated: `temp < 15 ? "Cold" : "Moderate"`. This is also false, so "Moderate" is chosen.' },
        q10: { answer: 'c', explanation: 'The `switch` looks for the value "Holiday", which doesn\'t match any `case`. Since there is no `default` block, nothing happens.' }
      };
      const totalQuestions = Object.keys(answerKey).length;
      
      // --- View Management ---
      function showView(viewId) {
          allViews.forEach(view => {
              view.style.display = view.id === viewId ? 'block' : 'none';
          });
      }

      // --- Navigation Event Listeners ---
      document.getElementById('nav-quiz').addEventListener('click', () => {
        quizForm.reset();
        showView('name-container');
      });
      document.getElementById('nav-admin').addEventListener('click', () => {
        showView('admin-container');
        loadAdminResults();
      });

      // --- Quiz Flow ---
      document.getElementById('start-quiz-btn').addEventListener('click', () => {
          userName = nameInput.value.trim();
          if (userName) {
              showView('quiz-container');
          } else {
              alert('Please enter your name.');
          }
      });

      quizForm.addEventListener('submit', (event) => {
          event.preventDefault();
          let score = 0;
          const userAnswers = {};
          for (const qId in answerKey) {
              const selectedOption = quizForm.querySelector(`input[name="${qId}"]:checked`);
              if (selectedOption) {
                  userAnswers[qId] = selectedOption.value;
                  if (selectedOption.value === answerKey[qId].answer) score++;
              } else {
                  userAnswers[qId] = "Not Answered";
              }
          }
          displayResults(score, userAnswers);
          saveResultsToFirebase(userName, score);
      });

      function displayResults(score, userAnswers) {
          showView('results-container');
          document.getElementById('result-header').textContent = `Results for ${userName}`;
          document.getElementById('score-text').innerHTML = `You scored <strong>${score}</strong> out of <strong>${totalQuestions}</strong>.`;
          
          const resultsList = document.getElementById('results-list');
          resultsList.innerHTML = ''; 

          document.querySelectorAll('.question-block').forEach(block => {
              const qId = block.getAttribute('data-question-id');
              const li = document.createElement('li');
              li.className = userAnswers[qId] === answerKey[qId].answer ? 'correct' : 'incorrect';
              li.innerHTML = `
                  <p><strong>${block.querySelector('h4').textContent}</strong></p>
                  <p>Your answer: ${userAnswers[qId] === "Not Answered" ? "<em>Not Answered</em>" : `<code>${userAnswers[qId]}</code>`}</p>
                  <div class="explanation"><strong>Explanation:</strong> ${answerKey[qId].explanation}</div>
              `;
              resultsList.appendChild(li);
          });
      }

      function saveResultsToFirebase(name, score) {
          const statusEl = document.getElementById('firebase-status');
          statusEl.textContent = "Saving results...";
          const resultsRef = ref(database, 'quizResults');
          const newResultRef = push(resultsRef); 
          set(newResultRef, {
              name: name,
              score: score,
              totalQuestions: totalQuestions,
              timestamp: new Date().toISOString()
          }).then(() => {
              statusEl.textContent = "Results saved successfully!";
              statusEl.style.color = "green";
          }).catch(error => {
              statusEl.textContent = "Could not save results.";
              statusEl.style.color = "red";
          });
      }
      
      // --- Admin Panel Logic ---
      const adminResultsBody = document.getElementById('admin-results-body');
      function loadAdminResults() {
          const resultsRef = ref(database, 'quizResults');
          const statusEl = document.getElementById('admin-status');

          onValue(resultsRef, (snapshot) => {
              adminResultsBody.innerHTML = '';
              if (snapshot.exists()) {
                  const data = snapshot.val();
                  const resultsArray = Object.entries(data).sort((a, b) => new Date(b[1].timestamp) - new Date(a[1].timestamp));

                  resultsArray.forEach(([key, result]) => {
                      const row = document.createElement('tr');
                      row.innerHTML = `
                          <td>${result.name}</td>
                          <td>${result.score} / ${result.totalQuestions}</td>
                          <td>${new Date(result.timestamp).toLocaleString()}</td>
                          <td><button class="delete-btn" data-key="${key}">Delete</button></td>
                      `;
                      adminResultsBody.appendChild(row);
                  });
                  statusEl.textContent = `Displaying ${resultsArray.length} result(s). Data is live.`;
              } else {
                  statusEl.textContent = "No quiz results found in the database.";
              }
          });
      }

      adminResultsBody.addEventListener('click', (event) => {
          if (event.target.classList.contains('delete-btn')) {
              const keyToDelete = event.target.getAttribute('data-key');
              if (confirm('Are you sure you want to delete this result?')) {
                  const resultRef = ref(database, `quizResults/${keyToDelete}`);
                  remove(resultRef)
                      .then(() => { console.log("Result deleted successfully."); })
                      .catch(error => { console.error("Error deleting result: ", error); });
              }
          }
      });

      // --- Initial Load ---
      showView('name-container');

    </script>
</body>
</html>
